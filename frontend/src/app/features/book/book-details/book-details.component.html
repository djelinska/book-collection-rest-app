<div>
  <h2>Szczegóły książki</h2>

  <div class="card mt-4">
    <div class="row g-0">
      <div class="col-md-4 d-flex">
        <img
          [src]="getImagePath(book.imagePath)"
          [alt]="book.title"
          class="w-100 object-fit-cover img-fluid rounded-start"
        />
      </div>
      <div class="col-md-8 d-flex flex-column">
        <div class="card-body">
          <div class="d-flex flex-wrap align-items-start gap-2">
            @for (shelf of book.shelves; track shelf.id) {
            <span class="badge text-bg-secondary mb-2">{{ shelf.name }}</span>
            }
          </div>
          <h3 class="card-title">{{ book.title }}</h3>
          <div class="card-subtitle mb-3 text-muted">
            {{ "Autor: " + book.author }}
          </div>
          <p class="card-text">
            <span>Opis:</span>
            <span>{{ book.description }}</span>
          </p>
          <button class="btn btn-primary mt-4">Dodaj do półki</button>
        </div>
        <div class="card-footer">
          <div class="d-flex justify-content-between">
            <p class="mb-0">
              Liczba osób, które przeczytały:
              <span>0</span>
            </p>
            <p class="mb-0">
              Liczba osób, które chcą przeczytać:
              <span>0</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-5">
    <h4>Informacje</h4>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <span>Wydawnictwo:</span>
        <span>{{ book.publisher }}</span>
      </li>
      <li class="list-group-item">
        <span>ISBN:</span>
        <span>{{ book.isbn }}</span>
      </li>
      <li class="list-group-item">
        <span>Rok wydania:</span>
        <span>{{ book.publicationYear }}</span>
      </li>
      <li class="list-group-item">
        <span>Gatunek:</span>
        <span>{{ genreNames[book.genre] }}</span>
      </li>
      <li class="list-group-item">
        <span>Liczba stron:</span>
        <span>{{ book.pageCount }}</span>
      </li>
      <li class="list-group-item">
        <span>Język:</span>
        <span>{{ languageNames[book.language] }}</span>
      </li>
    </ul>
  </div>

  <div class="mt-5">
    <h4>Recenzje</h4>
    <div class="p-4 mb-3 border rounded">
      <span class="rating">{{ book.averageRating.toFixed(1) }}</span>
      <p class="mb-0 text-muted">
        <span>{{ book.numberOfRatings }}</span> recenzji
      </p>
    </div>

    @for (review of book.reviews; track review.id) {
    <div
      class="border-bottom p-3 d-flex justify-content-between align-items-start"
    >
      <div class="d-flex flex-column w-75">
        <div class="mb-2">
          <span th:text="${review.user.username}">Użytkownik</span>
        </div>
        <div class="d-flex align-items-center mb-2">
          <span
            class="badge bg-secondary me-2"
            th:text="'Ocena: ' + ${review.rating}"
            >Ocena: 0</span
          >
        </div>
        <p class="text-muted">{{ review.createdAt | date : "dd MMM yyyy" }}</p>
        <p class="mb-0" th:text="${review.content}">Treść recenzji</p>
      </div>

      <div
        th:if="${#authentication.name == review.user.username}"
        class="d-flex flex-column align-items-center justify-content-center"
      >
        <form
          th:action="@{/reviews/{id}/delete(id=${review.id})}"
          method="post"
          onsubmit="return confirm('Czy na pewno chcesz usunąć tę recenzję?');"
        >
          <button type="submit" class="btn btn-outline-danger btn-sm">
            Usuń
          </button>
        </form>
      </div>
    </div>
    } @empty {
    <div class="alert alert-warning">
      Ta książka nie ma jeszcze recenzji. Bądź pierwszy, który ją oceni!
    </div>
    }

    <div class="mt-4">
      <h4>Dodaj recenzję</h4>
      <div class="row">
        <div class="col-md-6">
          <form>
            <div class="mb-3">
              <label for="rating" class="form-label">Ocena (1-5)</label>
              <input
                type="number"
                id="rating"
                name="rating"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="content" class="form-label">Treść recenzji</label>
              <textarea
                id="content"
                name="content"
                class="form-control"
                rows="4"
                placeholder="Napisz swoją recenzję..."
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Dodaj</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
